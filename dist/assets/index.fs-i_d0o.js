(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const S="0xc0598599bFF9887467472DA268309fF8A9538b7A",g="0xaa36a7",k=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"memberId",type:"uint32"},{indexed:!1,internalType:"address",name:"wallet",type:"address"},{indexed:!1,internalType:"bool",name:"isAnonymous",type:"bool"}],name:"MemberRegistered",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"levelId",type:"uint32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"MembershipLevelCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"memberId",type:"uint32"},{indexed:!1,internalType:"uint32",name:"newLevel",type:"uint32"}],name:"MemberLevelUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"memberId",type:"uint32"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"PrivateActivityRecorded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"memberId",type:"uint32"}],name:"MemberDeactivated",type:"event"},{inputs:[],name:"registerPublicMember",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"anonymousToken",type:"bytes32"}],name:"registerAnonymousMember",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"activityScore",type:"uint32"}],name:"recordPrivateActivity",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"memberId",type:"uint32"}],name:"updateMemberLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"uint32",name:"requiredScore",type:"uint32"},{internalType:"uint64",name:"benefits",type:"uint64"}],name:"createMembershipLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"memberId",type:"uint32"}],name:"deactivateMember",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"memberId",type:"uint32"}],name:"getMemberInfo",outputs:[{internalType:"bool",name:"isActive",type:"bool"},{internalType:"bool",name:"isAnonymous",type:"bool"},{internalType:"address",name:"wallet",type:"address"},{internalType:"uint256",name:"publicJoinTime",type:"uint256"},{internalType:"uint256",name:"activityCount",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getMyMemberId",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"wallet",type:"address"}],name:"isMember",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint32",name:"levelId",type:"uint32"}],name:"getMembershipLevelInfo",outputs:[{internalType:"string",name:"name",type:"string"},{internalType:"bool",name:"isActive",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"getSystemStats",outputs:[{internalType:"uint32",name:"totalMembersCount",type:"uint32"},{internalType:"uint32",name:"totalLevels",type:"uint32"},{internalType:"uint32",name:"nextMemberId",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"generateAnonymousToken",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalMembers",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"}];let f,p,r,m,d=!1;const b=document.getElementById("connectWallet"),P=document.getElementById("disconnectWallet"),E=document.getElementById("walletInfo"),D=document.getElementById("walletAddress"),T=document.getElementById("mainContent"),w=document.getElementById("loading"),y=document.getElementById("message"),F=document.getElementById("totalMembers"),O=document.getElementById("totalLevels"),h=document.getElementById("myMemberId"),I=document.getElementById("memberStatus"),N=document.getElementById("membershipType"),M=document.getElementById("joinDate"),q=document.getElementById("activityCount"),R=document.getElementById("registerPublic"),W=document.getElementById("registerAnonymous"),_=document.getElementById("recordActivity"),U=document.getElementById("updateLevel"),$=document.getElementById("generateToken"),j=document.getElementById("createLevel"),H=document.getElementById("deactivateMember"),L=document.querySelector(".admin-section"),J=document.querySelector(".token-display"),z=document.getElementById("generatedToken");document.addEventListener("DOMContentLoaded",v);window.initApp=v;function v(){if(typeof ethers>"u"){console.warn("Ethers not yet loaded, waiting..."),setTimeout(v,100);return}console.log("Initializing application..."),i(!1),b.addEventListener("click",A),P.addEventListener("click",C),R.addEventListener("click",G),W.addEventListener("click",Q),_.addEventListener("click",V),U.addEventListener("click",X),$.addEventListener("click",Y),j.addEventListener("click",Z),H.addEventListener("click",ee),K(),console.log("Application initialized successfully")}async function K(){if(console.log("Checking wallet connection..."),typeof window.ethereum<"u")try{const e=await window.ethereum.request({method:"eth_accounts"});console.log("Found accounts:",e.length),e.length>0?(console.log("Auto-connecting to wallet..."),await A()):console.log("No connected accounts found")}catch(e){console.error("Error checking wallet connection:",e)}else console.log("MetaMask not detected")}async function A(){if(typeof window.ethereum>"u"){n("Please install MetaMask to use this application","error");return}try{if(i(!0),(await window.ethereum.request({method:"eth_requestAccounts"})).length===0){n("No accounts found. Please connect your MetaMask wallet.","error");return}if(await window.ethereum.request({method:"eth_chainId"})!==g)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:g}]})}catch(t){if(t.code===4902)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:g,chainName:"Sepolia Testnet",nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},rpcUrls:["https://sepolia.infura.io/v3/"],blockExplorerUrls:["https://sepolia.etherscan.io/"]}]})}catch{n("Failed to add Sepolia network to MetaMask","error");return}else{n("Failed to switch to Sepolia network","error");return}}f=new ethers.BrowserProvider(window.ethereum),p=await f.getSigner(),m=await p.getAddress(),r=new ethers.Contract(S,k,p);try{console.log("Testing contract connection...");const t=await r.totalMembers();console.log("Contract connected successfully, total members:",t.toString())}catch(t){console.error("Contract connection failed:",t),n("Failed to connect to contract. Please check the contract address.","error"),i(!1);return}try{d=(await r.owner()).toLowerCase()===m.toLowerCase(),d&&L.classList.remove("hidden")}catch(t){console.error("Error checking owner status:",t)}D.textContent=`${m.slice(0,6)}...${m.slice(-4)}`,b.classList.add("hidden"),E.classList.remove("hidden"),T.classList.remove("hidden"),console.log("Loading initial data..."),await u(),n("Connected to Sepolia! âœ…","success"),console.log("Wallet connection completed successfully"),window.ethereum.on("accountsChanged",B),window.ethereum.on("chainChanged",x)}catch(e){console.error("Error connecting wallet:",e),n("Failed to connect wallet: "+e.message,"error")}finally{i(!1)}}async function C(){f=null,p=null,r=null,m=null,d=!1,b.classList.remove("hidden"),E.classList.add("hidden"),T.classList.add("hidden"),L.classList.add("hidden"),window.ethereum&&(window.ethereum.removeListener("accountsChanged",B),window.ethereum.removeListener("chainChanged",x)),n("Wallet disconnected","info")}async function B(e){e.length===0?await C():location.reload()}function x(e){location.reload()}async function u(){console.log("Loading system data...");try{console.log("Loading system stats...");const e=await r.getSystemStats();console.log("System stats loaded:",{totalMembers:e.totalMembersCount.toString(),totalLevels:e.totalLevels.toString()}),F.textContent=e.totalMembersCount.toString(),O.textContent=e.totalLevels.toString(),console.log("Loading member info...");try{const o=await r.getMyMemberId();if(console.log("Member ID:",o.toString()),o>0){h.textContent=o.toString();const t=await r.getMemberInfo(o);if(console.log("Member info loaded:",{isActive:t.isActive,isAnonymous:t.isAnonymous,activityCount:t.activityCount.toString()}),I.textContent=t.isActive?"Active":"Inactive",N.textContent=t.isAnonymous?"Anonymous":"Public",!t.isAnonymous&&t.publicJoinTime>0){const l=new Date(t.publicJoinTime*1e3);M.textContent=l.toLocaleDateString()}else M.textContent="Private";q.textContent=t.activityCount.toString()}else console.log("User not registered as member"),h.textContent="Not registered",I.textContent="Not registered"}catch(o){console.error("Error loading member info:",o)}console.log("Data loading completed")}catch(e){console.error("Error loading data:",e),n("Failed to load data: "+e.message,"error")}}async function G(){if(!r){n("Please connect your wallet first","error");return}try{i(!0),await(await r.registerPublicMember()).wait(),n("Successfully registered as public member!","success"),await u()}catch(e){console.error("Error registering public member:",e),e.reason?n("Registration failed: "+e.reason,"error"):n("Registration failed: "+e.message,"error")}finally{i(!1)}}async function Q(){if(!r){n("Please connect your wallet first","error");return}const e=document.getElementById("anonymousToken"),o=e.value.trim();if(!o){n("Please enter an anonymous token","error");return}try{i(!0);const t=ethers.encodeBytes32String(o);await(await r.registerAnonymousMember(t)).wait(),n("Successfully registered as anonymous member!","success"),e.value="",await u()}catch(t){console.error("Error registering anonymous member:",t),t.reason?n("Registration failed: "+t.reason,"error"):n("Registration failed: "+t.message,"error")}finally{i(!1)}}async function V(){if(!r){n("Please connect your wallet first","error");return}const e=document.getElementById("activityScore"),o=parseInt(e.value);if(!o||o<1||o>1e3){n("Please enter a valid activity score (1-1000)","error");return}try{i(!0),await(await r.recordPrivateActivity(o)).wait(),n("Activity recorded successfully!","success"),e.value="",await u()}catch(t){console.error("Error recording activity:",t),t.reason?n("Failed to record activity: "+t.reason,"error"):n("Failed to record activity: "+t.message,"error")}finally{i(!1)}}async function X(){if(!r){n("Please connect your wallet first","error");return}const e=document.getElementById("memberIdToUpdate"),o=parseInt(e.value);if(!o||o<1){n("Please enter a valid member ID","error");return}try{i(!0),await(await r.updateMemberLevel(o)).wait(),n("Member level updated successfully!","success"),e.value="",await u()}catch(t){console.error("Error updating member level:",t),t.reason?n("Failed to update level: "+t.reason,"error"):n("Failed to update level: "+t.message,"error")}finally{i(!1)}}async function Y(){if(!r||!d){n("Only the owner can generate tokens","error");return}try{i(!0);const e=await r.generateAnonymousToken();z.value=e,J.classList.remove("hidden"),n("Anonymous token generated!","success")}catch(e){console.error("Error generating token:",e),n("Failed to generate token: "+e.message,"error")}finally{i(!1)}}async function Z(){if(!r||!d){n("Only the owner can create membership levels","error");return}const e=document.getElementById("levelName"),o=document.getElementById("requiredScore"),t=document.getElementById("benefits"),l=e.value.trim(),a=parseInt(o.value),s=parseInt(t.value);if(!l||!a||!s){n("Please fill in all fields","error");return}try{i(!0),await(await r.createMembershipLevel(l,a,s)).wait(),n("Membership level created successfully!","success"),e.value="",o.value="",t.value="",await u()}catch(c){console.error("Error creating level:",c),c.reason?n("Failed to create level: "+c.reason,"error"):n("Failed to create level: "+c.message,"error")}finally{i(!1)}}async function ee(){if(!r||!d){n("Only the owner can deactivate members","error");return}const e=document.getElementById("memberIdToDeactivate"),o=parseInt(e.value);if(!o||o<1){n("Please enter a valid member ID","error");return}if(confirm(`Are you sure you want to deactivate member ${o}?`))try{i(!0),await(await r.deactivateMember(o)).wait(),n("Member deactivated successfully!","success"),e.value="",await u()}catch(t){console.error("Error deactivating member:",t),t.reason?n("Failed to deactivate member: "+t.reason,"error"):n("Failed to deactivate member: "+t.message,"error")}finally{i(!1)}}function i(e){e?w.classList.remove("hidden"):w.classList.add("hidden")}function n(e,o="info"){y.textContent=e,y.className=`message ${o}`,y.classList.remove("hidden"),setTimeout(()=>{y.classList.add("hidden")},5e3)}
